// ===================== RESOURCES PAGE =====================

// Define resource links configuration for each module
const RESOURCE_LINKS = {
    os: {
        cours: [
            { title: "Ch 1", url: "https://drive.google.com/file/d/1k7Oq70Hd9Wmd-O9_Jm-PLR1Mli5EVb8u/view?usp=drivesdk" },
            { title: "Ch 2-1", url: "https://drive.google.com/file/d/1t8t5GpW_ZezWN3kMHVqEAaOiibBRbZ0i/view?usp=drivesdk" },
            { title: "Ch 2-2", url: "https://drive.google.com/file/d/12h3nrhaiGwl2JEVf3JDuw5iyrE6qtzlZ/view?usp=drivesdk" },
            { title: "Ch 3", url: "https://drive.google.com/file/d/12_7PcwlboQobVFrlNLgzNVQAGw9pjh2N/view?usp=drivesdk" },
            { title: "Ch 4", url: "https://drive.google.com/file/d/109K3k9A0Fks7SZNEpGVgV5pnOXNndhb-/view?usp=drivesdk" }
        ],
        td: [
            { title: "SR 1", url: "https://drive.google.com/file/d/1mtz-zw0D4XHnrFf-hd1Agl_AdhvPM4hM/view?usp=drivesdk" },
            { title: "SR 1_Corr", url: "https://drive.google.com/file/d/10T3lWabK30Hcmmyq2tbOm06cHOKxtERZ/view?usp=drivesdk" },
            { title: "SR 2", url: "https://drive.google.com/file/d/12gOkCz-u2M8j0t9KnIEMM4CeSpamsQ_5/view?usp=drivesdk" },
            { title: "SR 2_Corr", url: "https://drive.google.com/file/d/1-yFMFipW_ZTHAz6gB5TmC7xgdBf5Co-q/view?usp=drivesdk" },
            { title: "SR 3", url: "https://drive.google.com/file/d/102YE4s9XK4lmPil53a5CmauWLfHnhIFx/view?usp=drivesdk" },
            { title: "SR3_Corr", url: "https://drive.google.com/file/d/1-v_2jbeHJtErQbFIVHHydVIp-QEuFyH8/view?usp=drivesdk" }
        ],
        tp: [
            { title: "PW 1", url: "https://drive.google.com/file/d/1n471xiyR229E-xwBW3DxQ6Bze7iJD7Zo/view?usp=drivesdk" },
            { title: "PW 2-1", url: "https://drive.google.com/file/d/12fAO-i1g9PCfnlk34eR7y4v0_17wg3mz/view?usp=drivesdk" },
            { title: "PW 2-2", url: "https://drive.google.com/file/d/152R4bk0Ed4R3v5YbEAfH9SvS-5vY3810/view?usp=drivesdk" },
            { title: "PW 3", url: "https://drive.google.com/file/d/10BB9hnEl6PPNDkSgytsD47w-Jk2oquLy/view?usp=drivesdk" }
        ]
    },
    tl: {
        cours: [
            { title: "Ch 1", url: "https://drive.google.com/file/d/1lw1J1HkjpeUQ2CUPJvrWVKn272tXwZtn/view?usp=drivesdk" },
            { title: "Ch 1->3", url: "https://drive.google.com/file/d/1qMmgeZBUuufFiCp0a1EujVFElXofvNjv/view?usp=drivesdk" },
            { title: "Ch 1->4", url: "https://drive.google.com/file/d/19XzR8aVIQlmjkbgWedWBKY1K1FSHxZMR/view?usp=drivesdk" },
            { title: "Ch 1->5(All)", url: "https://drive.google.com/file/d/10Ppfz81X5eZxRoUV6FaxoDigHVYOeg9A/view?usp=drivesdk" }
        ],
        td: [
            { title: "SR 1", url: "https://drive.google.com/file/d/19kXul_QQpoReewCkqq8jAr_B4E2PJQH2/view?usp=drivesdk" },
            { title: "SR 2", url: "https://drive.google.com/file/d/1pyt-dXmVUgT5rwT2CIljCf1LAmHyC6x5/view?usp=drivesdk" },
            { title: "SR 3", url: "https://drive.google.com/file/d/14k5KZtQM8UdVvC5Ctb52W7ERTjghCxcl/view?usp=drivesdk" }
        ],
        tp: [
            { title: "PW 1", url: "https://drive.google.com/file/d/1rUWoIdPFKtA70Iw6HwsjvtSgqALz0G1A/view?usp=drivesdk" },
            { title: "PW 2", url: "https://drive.google.com/file/d/1rVPJGyNvpp2mYxf5-c0IkZOW4XIgE-Jd/view?usp=drivesdk" },
            { title: "PW 3", url: "https://drive.google.com/file/d/1-iE0ahfCn4UXpr9q3Dql9xS2sOdSVIf4/view?usp=drivesdk" },
            { title: "PW 4", url: "https://drive.google.com/file/d/19YhEidjS2eqQ1wkKxaFP5oXGSYnWgtXo/view?usp=drivesdk" }
        ]
    },
    rc: {
        cours: [
            { title: "Ch 1 PDF", url: "https://drive.google.com/file/d/1j7K5l-YOqfFdtfh9eOH3itfpZgyNVfQb/view?usp=drivesdk" },
            { title: "Ch 2 PDF", url: "https://drive.google.com/file/d/1j98Dgf5rFX_hoA5U5lQdMi6WKQaoz9SF/view?usp=drivesdk" },
            { title: "Ch 3 PDF", url: "https://drive.google.com/file/d/1ClU2kM4i22X1oTYCYbl0FqL5hB2ACe1d/view?usp=drivesdk" },
            { title: "Ch 4 PDF", url: "https://drive.google.com/file/d/1CLT4XRlT1QIMuquWYDWCxFVvSpD0YXLj/view?usp=drivesdk" },
            { title: "Ch 1 PP", url: "https://drive.google.com/file/d/1B2PgOgBSaUzzNJ47qVYyu1275WoKVFPw/view?usp=drivesdk" },
            { title: "Ch 2 PP", url: "https://drive.google.com/file/d/1B4LYY81xfk6cAlUxPJnCoPnF_h6-eTao/view?usp=drivesdk" },
            { title: "Ch 3 PP", url: "https://drive.google.com/file/d/1CTadfevizSldgW3jNW3IIWom2d1wOY3f/view?usp=drivesdk" },
            { title: "Ch 4 PP", url: "https://drive.google.com/file/d/1B-3yZlonDhLhFbfY6snwuJ6Gczptbnn1/view?usp=drivesdk" }
        ],
        td: [
            { title: "SR 0", url: "https://drive.google.com/file/d/1jt3z6vz7NAqkUtK-O3tvFphxylwicAIE/view?usp=drivesdk" },
            { title: "SR 1", url: "https://drive.google.com/file/d/1paxM3QyW3UO2gXBew9R2wx7WhdyrQK8j/view?usp=drivesdk" },
            { title: "SR 2", url: "https://drive.google.com/file/d/1t2CYuL9U200wxEq6J8kFN2C_EdpOxugl/view?usp=drivesdk" },
            { title: "SR 3", url: "https://drive.google.com/file/d/1zpvmDLCEw2QNeU0WUfq5_e2pIlPswGNE/view?usp=drivesdk" },
            { title: "SR 4", url: "https://drive.google.com/file/d/19TD3VVWCcmud1-UZj4F6gJ7VUbzBcQRm/view?usp=drivesdk" },
            { title: "SR 5", url: "https://drive.google.com/file/d/1-1CpB-iu5rCAUP6thHBdDdiF7SydoNWf/view?usp=drivesdk" }
        ],
        tp: [
            { title: "PW Intro", url: "https://drive.google.com/file/d/1jnSxcVFDtdQYIui8l1RRGzpCJu8AHxjF/view?usp=drivesdk" },
            { title: "PW Ch 1", url: "https://drive.google.com/file/d/1CwVQP8et4gMS7jF5GMFURGmDH0Sgi3_t/view?usp=drivesdk" },
            { title: "PW Ch 2", url: "https://drive.google.com/file/d/152tDIt3IOg-7KwrNbrz3B0LLQ-HkaBbs/view?usp=drivesdk" }
        ],
        exam: [
            { title: "ShortEx2_24", url: "https://drive.google.com/file/d/12dA83LWJS8mld3qa3bN1cM5Tu6MkqnIQ/view?usp=drivesdk" },
            { title: "Exam24_Corr", url: "https://drive.google.com/file/d/17K32HYAwfJg5ZE-CwI8DpLJdb_naCo4E/view?usp=drivesdk" }
        ]
    },
    bd: {
        cours: [
            { title: "Ch 1", url: "https://drive.google.com/file/d/1mOWSFQ7qxrFkH4mW-EL8qN5bd0IlIV68/view?usp=drivesdk" },
            { title: "Ch 2", url: "https://drive.google.com/file/d/1syUXCK1TvtRT2jiOZNxHyInhLBPMVoE4/view?usp=drivesdk" },
            { title: "Ch 3", url: "https://drive.google.com/file/d/14kmq7TyoZS7RS6vVJD5nUEulOa-ilesA/view?usp=drivesdk" },
            { title: "Ch 4", url: "https://drive.google.com/file/d/19SKgClczwzbT8T7h9BFV4JFfbb9N71AZ/view?usp=drivesdk" },
            { title: "Ch 5", url: "https://drive.google.com/file/d/1-1YATL6Z1jEPgllSMnfcwtZPph6ccHXz/view?usp=drivesdk" }
        ],
        td: [
            { title: "SR 0", url: "https://drive.google.com/file/d/1jt3z6vz7NAqkUtK-O3tvFphxylwicAIE/view?usp=drivesdk" },
            { title: "SR 1", url: "https://drive.google.com/file/d/1paxM3QyW3UO2gXBew9R2wx7WhdyrQK8j/view?usp=drivesdk" },
            { title: "SR 2", url: "https://drive.google.com/file/d/1t2CYuL9U200wxEq6J8kFN2C_EdpOxugl/view?usp=drivesdk" },
            { title: "SR 3", url: "https://drive.google.com/file/d/1zpvmDLCEw2QNeU0WUfq5_e2pIlPswGNE/view?usp=drivesdk" },
            { title: "SR 4", url: "https://drive.google.com/file/d/19TD3VVWCcmud1-UZj4F6gJ7VUbzBcQRm/view?usp=drivesdk" },
            { title: "SR 5", url: "https://drive.google.com/file/d/1-1CpB-iu5rCAUP6thHBdDdiF7SydoNWf/view?usp=drivesdk" }
        ],
        tp: [
            { title: "PW 0", url: "https://drive.google.com/file/d/1lLsNOZLJA-gWNJzxxSKXLwnkFk_7ENnv/view?usp=drivesdk" },
            { title: "PW 1", url: "https://drive.google.com/file/d/1pcma5hR3Cj35128LUXu1aUlfEmMVBFfA/view?usp=drivesdk" },
            { title: "PW 3", url: "https://drive.google.com/file/d/14lcmf3rEPwj0pnvOHJaSfp8Vwhz25nx_/view?usp=drivesdk" },
            { title: "PW 4", url: "https://drive.google.com/file/d/1--pUJgfnLlX0O18xrue1Gsn-9d4ETTcF/view?usp=drivesdk" }
        ]
    },
    poo: {
        cours: [
            { title: "Ch 1", url: "https://drive.google.com/file/d/1iQAVqK_O6TD6qj_DlY-lk5G-uLJFWBOD/view?usp=drivesdk" },
            { title: "Ch 2", url: "https://drive.google.com/file/d/1s8Qk1b-XsrF-u5stonVCEYX3GsnD-EDO/view?usp=drivesdk" },
            { title: "Ch 3", url: "https://drive.google.com/file/d/1sIwr5LsHi79xeCkeu-zm5jDzgd5xL3eH/view?usp=drivesdk" },
            { title: "Ch 4", url: "https://drive.google.com/file/d/1vzZTSLj1zO7V3E8xG1Af_zrIiJANnDf2/view?usp=drivesdk" },
            { title: "Ch 5", url: "https://drive.google.com/file/d/1-iXWgCZhXHmEGEOZ52LfqAzTc5kE51eS/view?usp=drivesdk" },
            { title: "Ch 6", url: "https://drive.google.com/file/d/1-l25TfTBpEDsvdh8FjvpU6384v7_B1a5/view?usp=drivesdk" },
            { title: "Ch 7", url: "https://drive.google.com/file/d/13JcxzocwsrIM-GlHYXy6WtY0v95Ypn48/view?usp=drivesdk" },
            { title: "Ch 8", url: "https://drive.google.com/file/d/16rREmtNiaAV4uCDVZblWI4TyVECHvO5N/view?usp=drivesdk" },
            { title: "Ch 9", url: "https://drive.google.com/file/d/19U-hwnJjb6XmZTUA-L_UkXYNFCxE2A3u/view?usp=drivesdk" },
            { title: "Ch 10", url: "https://drive.google.com/file/d/1CgOTitj2NHzd0SP0tDcIZ-2sYUcov_n4/view?usp=drivesdk" },
            { title: "Intro", url: "https://drive.google.com/file/d/1n8ASbsfVQvuHreSzP31_y225ulq0XJ2S/view?usp=drivesdk" }
        ],
        tp: [
            { title: "PW 1", url: "https://drive.google.com/file/d/1iVKaQcsRZLHlj4ONAEc43P9OEcBMh3g7/view?usp=drivesdk" },
            { title: "PW 2", url: "https://drive.google.com/file/d/1xQgSDSx73VY9GGk0fshMGGIpri3Z3Lat/view?usp=drivesdk" },
            { title: "PW 3", url: "https://drive.google.com/file/d/11PuOE5_jBvuXYkonIaXSjwwLH4zUnMCg/view?usp=drivesdk" },
            { title: "PW 4", url: "https://drive.google.com/file/d/109D0IGnGi6emB6YWMh_6qkp_YHrEP6SK/view?usp=drivesdk" }
        ]
    },
    web: {
        cours: [
            { title: "HTML Ch1", url: "https://drive.google.com/file/d/1-pdqSOfSib1GEQoAXIG8rZRw_9QEHFuk/view?usp=drivesdk" },
            { title: "CSS", url: "https://drive.google.com/file/d/160vs5bYJtDKSREGkeyyW_i9JLHEKtbZ_/view?usp=drivesdk" },
            { title: "PHP Intro", url: "https://drive.google.com/file/d/168CQN3OFKpmRHFd8qQD7LcA5DghRL8i2/view?usp=drivesdk" },
            { title: "PHP Ch1", url: "https://drive.google.com/file/d/13UiNu7r8t4cxu5slztB_ciyTw8nC7gDM/view?usp=drivesdk" }
        ],
        tp: [
            { title: "PW 1", url: "https://drive.google.com/file/d/1oLWckLK8rYQ6l0OGq3ZIISAp-kC_sNH1/view?usp=drivesdk" },
            { title: "PW 2", url: "https://drive.google.com/file/d/1vNAaL17hH6VkUWwStBVTf-uAN_n51nmm/view?usp=drivesdk" },
            { title: "PW 3", url: "https://drive.google.com/file/d/1y1_M55ljlvqil67Q5HBuKrZhDroHSMRQ/view?usp=drivesdk" },
            { title: "PW 4", url: "https://drive.google.com/file/d/16VZQPeN5DppXVnVyupLapXsU_1fBIynO/view?usp=drivesdk" },
            { title: "PW 5", url: "https://drive.google.com/file/d/11FbnVK62uS0b_wUxz4u7wauoUB_ar9xt/view?usp=drivesdk" }
        ]
    },
    eng: {
        cours: [
            { title: "Ch 1", url: "https://drive.google.com/file/d/10dT06CLNEg4sqtOOFjSlnFz8N9xUy76V/view?usp=drivesdk" },
            { title: "Ch 2", url: "https://drive.google.com/file/d/10b8_qzDCokhNaZOaenkzv2oW3pzk_lOe/view?usp=drivesdk" },
            { title: "Ch 4", url: "https://drive.google.com/file/d/10fQn-P_AbMnrA1KojzRmm0uJVFHyZpVS/view?usp=drivesdk" },
            { title: "Ch 5", url: "https://drive.google.com/file/d/10hQSXXVaLWqlkCKHNwjyp7Bc52mKy5qS/view?usp=drivesdk" }
        ],
        exam: [
            { title: "Exam24_Corr", url: "https://drive.google.com/file/d/185lP7Ya-Wn-8NgEaFXoDm40JRzefzzDf/view?usp=drivesdk" }
        ],
    }
};

/**
 * Initializes the resources page with S4 modules
 */
function initResourcesPage() {
    const moduleList = document.querySelector('.module-list');

    if (!moduleList) return;

    // Get S4 modules from the existing MODULES object
    const s4Modules = MODULES.s4;

    // Clear any existing content
    moduleList.innerHTML = '';

    // Create module cards for each S4 module
    s4Modules.forEach(module => {
        const moduleCard = document.createElement('div');
        moduleCard.className = 'module-card';

        // Generate HTML for each resource section based on the configuration
        const coursSection = generateResourceSection(module.key, 'Cours', 'cours', module);
        const tdSection = generateResourceSection(module.key, 'TD (Travaux Dirig√©s)', 'td', module);
        const tpSection = generateResourceSection(module.key, 'TP (Travaux Pratiques)', 'tp', module);
        const examSection = generateResourceSection(module.key, 'Examens', 'exam', module);

        moduleCard.innerHTML = `
            <button class="module-header">
                <span>${module.name}</span>
                <svg class="arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </button>
            <div class="module-content">
                ${coursSection}
                ${tdSection}
                ${tpSection}
                ${examSection}
            </div>
        `;

        moduleList.appendChild(moduleCard);
    });

    // Add event listeners to the accordion headers
    setupAccordionEvents();
}

/**
 * Generates HTML for a resource section (Cours/TD/TP)
 */
function generateResourceSection(moduleKey, sectionTitle, sectionType, module) {
    // Check if the module has this type of resource (hasTP, tpOnly, etc.)
    if (sectionType === 'tp' && module.tpOnly && !module.hasTP) {
        // For tpOnly modules, we still show the TP section
    } else if (sectionType === 'td' && module.tpOnly) {
        // Don't show TD section for tpOnly modules
        if (module.key !== 'eng') {  // Special case: English doesn't have TD/TP
            return '';
        }
    }

    const resources = RESOURCE_LINKS[moduleKey] && RESOURCE_LINKS[moduleKey][sectionType]
        ? RESOURCE_LINKS[moduleKey][sectionType]
        : [];

    // Return empty string if there are no resources for this section
    if (resources.length === 0) {
        return '';
    }

    const linksHtml = resources.map((resource, index) =>
        `<a href="${resource.url}" class="resource-link" target="_blank">${resource.title}</a>`
    ).join('');

    return `
        <div class="resource-section">
            <button class="resource-header">
                <span>${sectionTitle}</span>
                <svg class="arrow" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="6 9 12 15 18 9"></polyline>
                </svg>
            </button>
            <div class="resource-links">
                ${linksHtml}
                ${resources.length === 0 ? '<div class="no-resources">Aucun lien disponible pour le moment</div>' : ''}
            </div>
        </div>
    `;
}

/**
 * Sets up the accordion events for modules
 */
function setupAccordionEvents() {
    const moduleHeaders = document.querySelectorAll('.module-header');
    const semesterHeader = document.querySelector('.accordion-header');
    const resourceHeaders = document.querySelectorAll('.resource-header');

    // Toggle individual module accordions
    moduleHeaders.forEach(header => {
        header.addEventListener('click', function () {
            const content = this.nextElementSibling;
            const arrow = this.querySelector('.arrow');

            content.classList.toggle('active');
            arrow.classList.toggle('rotate');
        });
    });

    // Toggle semester accordion
    semesterHeader.addEventListener('click', function () {
        const content = this.nextElementSibling;
        const arrow = this.querySelector('.arrow');

        content.classList.toggle('active');
        arrow.classList.toggle('rotate');
    });

    // Toggle individual resource accordions (Cours/TD/TP)
    resourceHeaders.forEach(header => {
        header.addEventListener('click', function () {
            const content = this.nextElementSibling;
            const arrow = this.querySelector('.arrow');

            content.classList.toggle('active');
            arrow.classList.toggle('rotate');
        });
    });
}